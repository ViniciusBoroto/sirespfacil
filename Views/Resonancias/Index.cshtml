@using SirespFacil.Models.ViewModels
@model List<RessonanciaMagnetica>

<link href="~/css/formulario.css" rel="stylesheet" />
<link href="~/css/Resonancias.css" rel="stylesheet" />

<div class="form-content">
    <div class="progress-indicator"></div>

    <div class="form-header">
        <h1><i class="fas fa-images me-3"></i>Ressonâncias</h1>
        <p>Exames cadastrados — clique em uma prévia para ver todos os detalhes.</p>
    </div>

    <div class="section-card">
        <h2 class="section-title"><i class="fas fa-list"></i> Resonâncias Realizadas</h2>

        @if (Model.Count > 0)
        {	
            <div class="exames-grid">
                @foreach (var ressonancia in Model)
                {
                    <div class="exame-card fade-in" 
                        data-tipo="@(ressonancia.Solicitante?.Unidade?.Nome ?? "N/A")" 
                        data-data="@ressonancia.Data.ToString("dd/MM/yyyy")"
                        data-paciente="@(ressonancia.Paciente?.Nome ?? "N/A")"
                        data-motivo="@(ressonancia.Motivo ?? "N/A")"
                        data-peso="@ressonancia.Peso"
                        data-altura="@ressonancia.Altura"
                        data-circunferencia="@ressonancia.CircunferenciaAbdominal"
                        data-ureia="@ressonancia.ValorUreia"
                        data-creatinina="@ressonancia.ValorCreatinina"
                        data-diagnostico="@(ressonancia.DescricaoDiagnostico ?? "N/A")"
                        data-cid-principal="@(ressonancia.CIDPrincipal ?? "N/A")"
                        data-cid-secundario="@(ressonancia.CIDSecundario ?? "N/A")"
                        data-cid-causas="@(ressonancia.CIDCausasAssociadas ?? "N/A")">
                        <div class="exame-preview p-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="badge bg-primary">@(ressonancia.Solicitante?.Unidade?.Nome ?? "Unidade Desconhecida")</span>
                                <small class="text-muted"><i class="far fa-calendar-alt me-1"></i>@ressonancia.Data.ToString("dd/MM/yyyy")</small>
                            </div>
                            <h5 class="mb-1 text-truncate" title="@(ressonancia.Paciente?.Nome)">
                                <i class="fas fa-user-injured me-2 text-secondary"></i>@(ressonancia.Paciente?.Nome ?? "Paciente Desconhecido")
                            </h5>
                            <p class="mb-0 text-muted small text-truncate" title="@(ressonancia.Motivo)">
                                <strong>Motivo:</strong> @(ressonancia.Motivo ?? "Não informado")
                            </p>
                        </div>
                        <div class="exame-actions border-top p-2 bg-light">
                            <button class="btn-modern btn-sm ver-detalhes w-100" type="button"><i class="fas fa-eye me-2"></i>Ver detalhes</button>
                        </div>
                    </div>
                }
            </div>
        }

        else
        {
            <div class="text-document">Nenhum exame encontrado.</div>
        }
    </div>

</div>

<!-- Modal de detalhes -->
<div class="modal fade" id="detalheModal" tabindex="-1" aria-labelledby="detalheModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detalheModalLabel"><i class="fas fa-file-medical me-2"></i> Detalhes do Exame</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-primary"><i class="fas fa-user me-2"></i>Informações do Paciente</h6>
                        <div class="detalhe-row"><strong>Nome:</strong> <span id="detalhe-paciente"></span></div>
                        <div class="detalhe-row"><strong>Unidade:</strong> <span id="detalhe-tipo"></span></div>
                        <div class="detalhe-row"><strong>Data:</strong> <span id="detalhe-data"></span></div>
                        <div class="detalhe-row"><strong>Motivo:</strong> <span id="detalhe-motivo"></span></div>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-primary"><i class="fas fa-weight me-2"></i>Dados Físicos</h6>
                        <div class="detalhe-row"><strong>Peso:</strong> <span id="detalhe-peso"></span> kg</div>
                        <div class="detalhe-row"><strong>Altura:</strong> <span id="detalhe-altura"></span> m</div>
                        <div class="detalhe-row"><strong>Circunferência Abdominal:</strong> <span id="detalhe-circunferencia"></span> cm</div>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-primary"><i class="fas fa-flask me-2"></i>Exames Laboratoriais</h6>
                        <div class="detalhe-row"><strong>Ureia:</strong> <span id="detalhe-ureia"></span> mg/dL</div>
                        <div class="detalhe-row"><strong>Creatinina:</strong> <span id="detalhe-creatinina"></span> mg/dL</div>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-primary"><i class="fas fa-notes-medical me-2"></i>Diagnóstico</h6>
                        <div class="detalhe-row"><strong>Descrição:</strong> <span id="detalhe-diagnostico"></span></div>
                        <div class="detalhe-row"><strong>CID Principal:</strong> <span id="detalhe-cid-principal"></span></div>
                        <div class="detalhe-row"><strong>CID Secundário:</strong> <span id="detalhe-cid-secundario"></span></div>
                        <div class="detalhe-row"><strong>CID Causas:</strong> <span id="detalhe-cid-causas"></span></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var detalheModalEl = document.getElementById('detalheModal');
        var detalheModal = new bootstrap.Modal(detalheModalEl);

        document.querySelectorAll('.ver-detalhes').forEach(function (btn) {
        btn.addEventListener('click', function (e) {
            var card = e.target.closest('.exame-card');
            if (!card) return;
            
            // Populate modal with card data
            document.getElementById('detalhe-paciente').textContent = card.dataset.paciente || 'N/A';
            document.getElementById('detalhe-tipo').textContent = card.dataset.tipo || 'N/A';
            document.getElementById('detalhe-data').textContent = card.dataset.data || 'N/A';
            document.getElementById('detalhe-motivo').textContent = card.dataset.motivo || 'N/A';
            document.getElementById('detalhe-peso').textContent = card.dataset.peso || '0';
            document.getElementById('detalhe-altura').textContent = card.dataset.altura || '0';
            document.getElementById('detalhe-circunferencia').textContent = card.dataset.circunferencia || '0';
            document.getElementById('detalhe-ureia').textContent = card.dataset.ureia || '0';
            document.getElementById('detalhe-creatinina').textContent = card.dataset.creatinina || '0';
            document.getElementById('detalhe-diagnostico').textContent = card.dataset.diagnostico || 'N/A';
            document.getElementById('detalhe-cid-principal').textContent = card.dataset.cidPrincipal || 'N/A';
            document.getElementById('detalhe-cid-secundario').textContent = card.dataset.cidSecundario || 'N/A';
            document.getElementById('detalhe-cid-causas').textContent = card.dataset.cidCausas || 'N/A';

            detalheModal.show();
            });
        });
    });
</script>
