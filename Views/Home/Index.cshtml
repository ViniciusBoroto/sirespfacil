@using SirespFacil.Models.ViewModels
@model RessonanciaMagneticaViewModel


<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Ressonância Magnética</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <link href="~/css/formulario.css" rel="stylesheet">
</head>
<body>

    
    <div class="form-container fade-in">
        <div class="progress-indicator"></div>
        
        <div class="form-header">
            <h1><i class="fas fa-microscope me-3"></i>Ressonância Magnética</h1>
            <p>Secretaria de Estado da Saúde - Coordenadoria de Regiões de Saúde - Grupo de Regulação</p>
        </div>

        <div class="section-card">
            <h2 class="section-title">
                <i class="fas fa-file-signature"></i> Critérios de Autorização
            </h2>

            <!-- Botão para abrir o modal -->
            <button type="button" class="btn-modern mb-4" data-bs-toggle="modal" data-bs-target="#modalCriterioAutorizacao">
                <i class="fas fa-plus"></i> Adicionar Critério de Autorização
            </button>

            <!-- Listagem dinâmica -->
            <div id="listaCriteriosAutorizacao"></div>
            <div id="inputsHiddenCriteriosAutorizacao"></div>
        </div>

        <!-- Modal de Adição -->
        <div class="modal fade" id="modalCriterioAutorizacao" tabindex="-1" aria-labelledby="modalCriterioAutorizacaoLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalCriterioAutorizacaoLabel">
                            <i class="fas fa-file-signature me-2"></i> Adicionar Critério de Autorização
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                    </div>

                    <div class="modal-body">
                        <div class="form-group mb-3">
                            <label for="criterioTipo" class="form-label">Tipo de Critério:</label>
                            <select id="criterioTipo" class="form-select">
                                <option value="">Selecione...</option>
                                <option value="Este Formulário">Este Formulário</option>
                                <option value="Laudo APAC">Laudo APAC</option>
                                <option value="Exame Realizado">Exame Realizado</option>
                                <option value="História Clínica">História Clínica</option>
                                <option value="Relatório Exame Físico">Relatório Exame Físico</option>
                            </select>
                        </div>

                        <div class="form-group mb-3">
                            <label for="criterioArquivo" class="form-label">Anexar Arquivo:</label>
                            <input type="file" id="criterioArquivo" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
                        </div>

                        <div class="form-group">
                            <label for="criterioObservacao" class="form-label">Observação (opcional):</label>
                            <textarea id="criterioObservacao" class="form-control" rows="2" placeholder="Adicione observações..."></textarea>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="btnSalvarCriterioAutorizacao">Salvar</button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let contadorCriterios = 0;

            document.getElementById("btnSalvarCriterioAutorizacao").addEventListener("click", function () {
              const tipo = document.getElementById("criterioTipo").value;
              const arquivoInput = document.getElementById("criterioArquivo");
              const observacao = document.getElementById("criterioObservacao").value;

              if (!tipo) {
                alert("Selecione o tipo de critério.");
                return;
              }

              contadorCriterios++;

              // Exibir lista
              const lista = document.getElementById("listaCriteriosAutorizacao");
              const itemDiv = document.createElement("div");
              itemDiv.classList.add("item-lista", "mb-2", "p-2", "border", "rounded");
              itemDiv.innerHTML = `
                <strong>${tipo}</strong>
                ${observacao ? `<br><small><em>${observacao}</em></small>` : ""}
                ${arquivoInput.files.length > 0 ? `<br><i class="fas fa-paperclip"></i> ${arquivoInput.files[0].name}` : ""}
                <button type="button" class="btn btn-sm btn-danger float-end" onclick="this.parentElement.remove()">Remover</button>
              `;
              lista.appendChild(itemDiv);

              // Criar inputs hidden
              const inputsHidden = document.getElementById("inputsHiddenCriteriosAutorizacao");
              const hiddenTipo = document.createElement("input");
              hiddenTipo.type = "hidden";
              hiddenTipo.name = `CriteriosAutorizacao[${contadorCriterios}].Tipo`;
              hiddenTipo.value = tipo;

              const hiddenObs = document.createElement("input");
              hiddenObs.type = "hidden";
              hiddenObs.name = `CriteriosAutorizacao[${contadorCriterios}].Observacao`;
              hiddenObs.value = observacao;

              inputsHidden.appendChild(hiddenTipo);
              inputsHidden.appendChild(hiddenObs);

              // Resetar modal
              document.getElementById("criterioTipo").value = "";
              document.getElementById("criterioArquivo").value = "";
              document.getElementById("criterioObservacao").value = "";
              const modal = bootstrap.Modal.getInstance(document.getElementById("modalCriterioAutorizacao"));
              modal.hide();
            });
        </script>


        </div>
        
        <div class="form-content">
            <form asp-action="SalvarFormulario" method="post" enctype="multipart/form-data">
                
                <div class="section-card">
                    <h2 class="section-title"><i class="fas fa-hospital"></i> Identificação do Serviço Solicitante</h2>
                    <div class="form-grid">
                        <div class="form-group"><label asp-for="Solicitante.Unidade" class="form-label">Unidade:</label><input asp-for="Solicitante.Unidade" type="text" class="form-control" placeholder="Nome da unidade solicitante"></div>
                        <div class="form-group"><label asp-for="Solicitante.Unidade.NIR" class="form-label">Telefone NIR:</label><input asp-for="Solicitante.Unidade.NIR" type="tel" class="form-control" placeholder="(11) 99999-9999"></div>
                        <div class="form-group"><label asp-for="Solicitante.Medico.Nome" class="form-label">Médico Solicitante:</label><input asp-for="Solicitante.Medico.Nome" type="text" class="form-control" placeholder="Nome do médico"></div>
                        <div class="form-group"><label asp-for="Solicitante.Medico.CRM" class="form-label">CRM:</label><input asp-for="Solicitante.Medico.CRM" type="text" class="form-control" placeholder="Número do CRM"></div>
                    </div>
                </div>

                <div class="section-card">
                    <h2 class="section-title"><i class="fas fa-user"></i> Identificação do Paciente</h2>
                    <div class="form-grid">
                        <div class="form-group full-width-field"><label asp-for="Paciente.Nome" class="form-label">Nome Completo:</label><input asp-for="Paciente.Nome" type="text" class="form-control" placeholder="Nome completo do paciente"></div>
                        <div class="form-group"><label asp-for="Paciente.CodigoSIRESP" class="form-label">Código SIRESP:</label><input asp-for="Paciente.CodigoSIRESP" type="text" class="form-control" placeholder="Código SIRESP"></div>
                        <div class="form-group"><label asp-for="Paciente.DataNascimento" class="form-label">Data de Nascimento:</label><input asp-for="Paciente.DataNascimento" type="date" class="form-control"></div>
                        <div class="form-group"><label asp-for="Paciente.Idade" class="form-label">Idade:</label><input asp-for="Paciente.Idade" type="number" class="form-control" placeholder="Anos"></div>
                        <div class="form-group">
                            <label asp-for="Paciente.Sexo" class="form-label">Sexo:</label>
                            <select asp-for="Paciente.Sexo" class="form-select"><option value="">Selecione...</option><option value="M">Masculino</option><option value="F">Feminino</option></select>
                        </div>
                        <div class="form-group"><label asp-for="Peso" class="form-label">Peso (Máx: 170kg):</label><input asp-for="Peso" type="number" step="0.01" class="form-control" placeholder="kg"></div>
                        <div class="form-group"><label asp-for="Altura" class="form-label">Altura:</label><input asp-for="Altura" type="number" step="0.01" class="form-control" placeholder="cm"></div>
                        <div class="form-group"><label asp-for="CircunferenciaAbdominal" class="form-label">Circunferência Abdominal (Máx: 136cm):</label><input asp-for="CircunferenciaAbdominal" type="number" step="0.01" class="form-control" placeholder="cm"></div>
                        <div class="form-group"><label asp-for="ValorUreia" class="form-label">UREIA:</label><input asp-for="ValorUreia" type="number" step="0.01" class="form-control" placeholder="mg/dL"></div>
                        <div class="form-group"><label asp-for="ValorCreatinina" class="form-label">CREATININA:</label><input asp-for="ValorCreatinina" type="number" step="0.01" class="form-control" placeholder="mg/dL"></div>
                    </div>
                </div>

                <div class="section-card">
                    <h2 class="section-title"><i class="fas fa-images"></i> Exames de Imagem Já Realizados</h2>
                    <button type="button" class="btn-modern mb-4" data-bs-toggle="modal" data-bs-target="#modalExameRealizado"><i class="fas fa-plus"></i> Adicionar Exame Realizado</button>
                    <div id="listaExamesRealizados"></div>
                    <div id="inputsHiddenExamesRealizados"></div>
                    <div class="form-group full-width-field mt-4">
                        <label asp-for="Motivo" class="form-label">Motivo da solicitação da ressonância (quando insuficiência dos exames anteriores):</label>
                        <textarea asp-for="Motivo" class="form-control" rows="3" placeholder="Descreva o motivo da solicitação..."></textarea>
                    </div>
                </div>

                <div class="section-card">
                    <h2 class="section-title"><i class="fas fa-stethoscope"></i> Exame Solicitado (Conforme Nomenclatura SESSP)</h2>
                    <button type="button" class="btn-modern mb-4" data-bs-toggle="modal" data-bs-target="#modalExame"><i class="fas fa-plus"></i> Adicionar Exame Solicitado</button>
                    <div id="listaExames"></div>
                    <div id="inputsHiddenExames"></div>
                </div>

            <div class="section-card">
                <h2 class="section-title">
                    <i class="fas fa-clipboard-check"></i> Justificativa do Exame Solicitado
                </h2>

                <!-- Tipos de Conduta -->
                <div class="form-group">
                    <label class="form-label">Tipo de Conduta:</label>
                    <div class="checkbox-group">
                        @foreach (var conduta in Model.TiposCondutas)
                        {
                            <div class="form-check-custom">
                                <input type="checkbox" id="conduta_@conduta.Id" value="@conduta.Id" name="CondutasSelecionadas" />
                                <label for="conduta_@conduta.Id">@conduta.Nome</label>
                            </div>
                        }
                    </div>
                </div>

                <!-- Justificativas -->
                <div class="form-group mt-4">
                    <label class="form-label">Tipo de Justificativa:</label>
                    <div class="checkbox-group">
                        @foreach (var justificativa in Model.TiposJustificativas)
                        {
                            <div class="form-check-custom">
                                <input type="checkbox" id="justificativa_@justificativa.Id" value="@justificativa.Id" name="JustificativasSelecionadas" />
                                <label for="justificativa_@justificativa.Id">@justificativa.Nome</label>
                            </div>
                        }
                    </div>
                </div>

                <!-- Diagnóstico e CID -->
                <div class="form-grid mt-4">
                    <div class="form-group full-width-field">
                        <label asp-for="DescricaoDiagnostico" class="form-label">Descrição do Diagnóstico:</label>
                        <textarea asp-for="DescricaoDiagnostico" class="form-control" rows="3" placeholder="Descreva o diagnóstico detalhadamente..."></textarea>
                    </div>
                    <div class="form-group">
                        <label asp-for="CIDPrincipal" class="form-label">CID Principal:</label>
                        <input asp-for="CIDPrincipal" type="text" class="form-control" placeholder="Ex: M79.9">
                    </div>
                    <div class="form-group">
                        <label asp-for="CIDSecundario" class="form-label">CID Secundário:</label>
                        <input asp-for="CIDSecundario" type="text" class="form-control" placeholder="Ex: M79.9">
                    </div>
                    <div class="form-group">
                        <label asp-for="CIDCausasAssociadas" class="form-label">CID Causas Associadas:</label>
                        <input asp-for="CIDCausasAssociadas" type="text" class="form-control" placeholder="Ex: M79.9">
                    </div>
                </div>
            </div>


                <div class="section-card">
                    <h2 class="section-title"><i class="fas fa-cog"></i> Implantes Metálicos e Outros</h2>
                    <p class="text-document mb-3">Indicar a presença de dispositivos (metálicos e outros)</p>
                    <button type="button" class="btn-modern mb-4" data-bs-toggle="modal" data-bs-target="#modalImplante"><i class="fas fa-plus"></i> Adicionar Implante</button>
                    <div id="listaImplantes"></div>
                    <div id="inputsHidden"></div>
                </div>

                <div class="section-card">
                    <h2 class="section-title"><i class="fas fa-signature"></i> Data e Assinatura</h2>
                    <div class="form-grid">
                        <div class="form-group"><label asp-for="Data" class="form-label">Data:</label><input asp-for="Data" type="date" class="form-control"></div>
                        <div class="form-group full-width-field"><p class="text-document mt-3">Assinatura e carimbo do médico solicitante</p></div>
                    </div>
                </div>
                
                <div class="text-center mt-5">
                    <button type="submit" class="btn-modern btn-primary-modern"><i class="fas fa-save"></i> Salvar Formulário</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal fade" id="modalExameRealizado" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-images me-2"></i>Adicionar Exame Realizado</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Tipo de Exame:</label>
                            <select class="form-select" id="tipoExameRealizado">
                                <option value="">Selecione o tipo...</option>
                                @foreach (TipoExame tipo in Model.TiposExames)
                                {
                                <option value="@tipo.Id">@tipo.Nome</option>
                                }

                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data do Exame:</label>
                            <input type="date" id="dataExameRealizado" class="form-control">
                        </div>
                        <div class="form-group full-width-field">
                            <label class="form-label">Laudo (opcional):</label>
                            <input type="file" id="laudoExameRealizado" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn-modern" onclick="adicionarExameRealizado()">
                        <i class="fas fa-plus"></i> Adicionar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalExame" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-stethoscope me-2"></i>Adicionar Exame Solicitado</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="form-grid">
                        <div class="form-group full-width-field">
                            <label class="form-label">Exame:</label>
                            <input type="text" id="exame" class="form-control" placeholder="Ex: RM Crânio">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Sedação:</label>
                            <select id="sedacao" class="form-select">
                                <option value="NAO">NÃO</option>
                                <option value="SIM">SIM</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Classificação ASA:</label>
                            <select id="classificacaoAsa" class="form-select">
                                <option value="">Selecione...</option>
                                <option value="1">I</option>
                                <option value="2">II</option>
                                <option value="3">III</option>
                                <option value="4">IV</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Lateralidade:</label>
                            <select id="lateralidade" class="form-select">
                                @foreach(Lateralidade lateralidade in Model.Lateralidades)
                                {
                                <option value="@lateralidade.Id">@lateralidade.Nome</option>
                                }
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn-modern" onclick="adicionarExame()">
                        <i class="fas fa-plus"></i> Adicionar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalImplante" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-cog me-2"></i>Adicionar Implante</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Dispositivo (Metálicos e Outros):</label>
                            <input type="text" id="dispositivo" class="form-control" placeholder="Ex: Marca-passo">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tempo de Uso:</label>
                            <input type="text" id="tempoDeUso" class="form-control" placeholder="Ex: 2 anos">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Material:</label>
                            <input type="text" id="material" class="form-control" placeholder="Ex: Titânio">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Localização:</label>
                            <input type="text" id="localizacao" class="form-control" placeholder="Ex: Região torácica">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn-modern" onclick="adicionarImplante()">
                        <i class="fas fa-plus"></i> Adicionar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/examesRealizados.js"></script>
    <script src="~/js/exames.js"></script>
    <script src="~/js/implantes.js"></script>
   


</body>
</html>[]